<div class="flight-card" [class.expanded]="isExpanded">
  <!-- Header: Siempre visible (cerrado por defecto) -->
  <div class="flight-card-header" (click)="toggleExpanded()">
    <div class="flights-summary">
      <!-- Vuelo de ida -->
      <div class="flight-row">
        <img
          [src]="outboundFlight.flightItems[0].imageUrl"
          [alt]="outboundFlight.flightItems[0].airlineName"
          class="airline-logo"
        />

        <div class="flight-info">
          <div class="flight-times">
            <span class="time">{{ formatTime(outboundFlight.flightItems[0].departureTime) }}</span>
            <span class="duration">{{ formatDuration(getTotalDuration(outboundFlight)) }}</span>
            <span class="time">
              {{
                formatTime(
                  outboundFlight.flightItems[outboundFlight.flightItems.length - 1].arrivalTime
                )
              }}
              <span
                class="day-offset"
                *ngIf="
                  getArrivalDayOffset(
                    outboundFlight.flightItems[0].departureTime,
                    outboundFlight.flightItems[outboundFlight.flightItems.length - 1].arrivalTime
                  )
                "
              >
                {{
                  getArrivalDayOffset(
                    outboundFlight.flightItems[0].departureTime,
                    outboundFlight.flightItems[outboundFlight.flightItems.length - 1].arrivalTime
                  )
                }}
              </span>
            </span>
          </div>
          <div class="flight-route">
            <span class="stops-info"
              >{{ getStopsText()
              }}<span *ngIf="flightTicket.maxStops > 0"
                >, {{ getStopsCodes(outboundFlight) }}</span
              ></span
            >
          </div>
          <div class="flight-airports">
            <span class="airport">{{ outboundFlight.flightItems[0].departure }}</span>
            <span class="airport">{{
              outboundFlight.flightItems[outboundFlight.flightItems.length - 1].arrival
            }}</span>
          </div>
        </div>
      </div>

      <!-- Vuelo de regreso (si existe) -->
      <div class="flight-row" *ngIf="returnFlight">
        <img
          [src]="returnFlight.flightItems[0].imageUrl"
          [alt]="returnFlight.flightItems[0].airlineName"
          class="airline-logo"
        />

        <div class="flight-info">
          <div class="flight-times">
            <span class="time">{{ formatTime(returnFlight.flightItems[0].departureTime) }}</span>
            <span class="duration">{{ formatDuration(getTotalDuration(returnFlight)) }}</span>
            <span class="time">
              {{
                formatTime(
                  returnFlight.flightItems[returnFlight.flightItems.length - 1].arrivalTime
                )
              }}
              <span
                class="day-offset"
                *ngIf="
                  getArrivalDayOffset(
                    returnFlight.flightItems[0].departureTime,
                    returnFlight.flightItems[returnFlight.flightItems.length - 1].arrivalTime
                  )
                "
              >
                {{
                  getArrivalDayOffset(
                    returnFlight.flightItems[0].departureTime,
                    returnFlight.flightItems[returnFlight.flightItems.length - 1].arrivalTime
                  )
                }}
              </span>
            </span>
          </div>
          <div class="flight-route">
            <span class="stops-info"
              >{{ getStopsText()
              }}<span *ngIf="flightTicket.maxStops > 0"
                >, {{ getStopsCodes(returnFlight) }}</span
              ></span
            >
          </div>
          <div class="flight-airports">
            <span class="airport">{{ returnFlight.flightItems[0].departure }}</span>
            <span class="airport">{{
              returnFlight.flightItems[returnFlight.flightItems.length - 1].arrival
            }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Icono de expansión -->
    <div class="expand-icon">
      <i class="pi" [class.pi-chevron-down]="!isExpanded" [class.pi-chevron-up]="isExpanded"></i>
    </div>
  </div>

  <!-- Contenido expandido (precios detallados) -->
  <div class="flight-card-body" *ngIf="isExpanded">
    <div class="pricing-details-grid">
      <!-- Precio por persona -->
      <div class="pricing-detail-item">
        <div class="detail-label">{{ texts.pricePerPerson }}</div>
        <div class="detail-value">${{ formatPrice(flightTicket.price) }}</div>
        <button class="select-button" (click)="onSelectFlight($event)">
          <span>{{ texts.selectButton }}</span>
        </button>
      </div>

      <!-- Precio mascota -->
      <div class="pricing-detail-item pet-price">
        <div class="detail-label">{{ texts.petPrice }}</div>
        <div class="detail-value">
          ${{ formatPrice(flightTicket.mrPrice?.min || 0) }}-{{
            formatPrice(flightTicket.mrPrice?.max || 200)
          }}
        </div>

        <div class="badges" *ngIf="hasPSPrice || hasAEPrice || hasMRPrice">
          <a
            *ngIf="hasPSPrice"
            href="https://petfly.io/certificados-de-perro-de-servicio/"
            target="_blank"
            rel="noopener noreferrer"
            class="badge badge-ps"
            (click)="$event.stopPropagation()"
          >
            {{ texts.psBadge }}
          </a>
          <a
            *ngIf="hasAEPrice"
            href="https://petfly.io/certificado-de-apoyo-emocional/"
            target="_blank"
            rel="noopener noreferrer"
            class="badge badge-ae"
            (click)="$event.stopPropagation()"
          >
            AE
          </a>
          <span *ngIf="hasMRPrice" class="badge badge-mr">{{ texts.mrBadge }}</span>
        </div>

        <div class="badge-hint" *ngIf="hasPSPrice || hasAEPrice || hasMRPrice">
          <i class="pi pi-info-circle"></i>
          <span>Haz clic en los certificados para más info</span>
        </div>

        <div class="certificate-status">
          <div class="ae-status" *ngIf="isAENotAccepted">{{ texts.aeNotAccepted }}</div>
          <div class="ae-status" *ngIf="isPSNotAccepted">{{ texts.psNotAccepted }}</div>
          <div class="ae-status" *ngIf="isMRNotAccepted">{{ texts.mrNotAccepted }}</div>
        </div>

        <div class="price-breakdown">
          <span *ngIf="hasMRPrice">
            {{ texts.mrLabel }}: ${{ formatPrice(flightTicket.mrPrice!.min) }}
          </span>
          <span *ngIf="hasMRPrice" class="separator">|</span>
          <span *ngIf="hasAEPrice">
            {{ texts.aeLabel }}: ${{ formatPrice(flightTicket.aePrice!.min) }}-{{
              formatPrice(flightTicket.aePrice!.max)
            }}
          </span>
          <span *ngIf="hasAEPrice && hasPSPrice" class="separator">|</span>
          <span *ngIf="hasPSPrice"
            >{{ texts.psLabel }}: ${{ formatPrice(flightTicket.psPrice!.min) }}</span
          >
        </div>
      </div>

      <!-- Precio total -->
      <div class="pricing-detail-item">
        <div class="detail-label">{{ texts.totalPrice }}</div>
        <div class="detail-subtitle">{{ texts.totalPriceSubtitle }}</div>
        <div class="detail-value total">
          ${{ formatPrice(flightTicket.total.min) }}-{{ formatPrice(flightTicket.total.max) }}
        </div>
      </div>
    </div>

    <!-- Advertencia -->
    <div class="price-warning">
      <i class="pi pi-hand-paper"></i>
      <span>{{ texts.priceEstimationWarning }}</span>
    </div>
  </div>
</div>
